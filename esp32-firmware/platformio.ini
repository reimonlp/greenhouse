; PlatformIO Project Configuration File for ESP32-C3 WebSocket Client with OTA
; Learning outcomes:
; - ESP32-C3 USB JTAG serial requires CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG
; - Use printf() with fflush(stdout) instead of Serial.println()
; - Auto port detection recommended for USB JTAG device
; - OTA requires mDNS and proper partition layout

[platformio]
default_envs = greenhouse-esp32c3

[env:greenhouse-esp32c3]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
upload_speed = 460800
build_type = release

; ESP32-C3 specific: Must enable USB Serial/JTAG console and OTA support
build_flags = 
	-D ENABLE_STATUS_LED
	-D DHT_STABILIZE_MS=1500
	-D BOARD_HAS_PSRAM=0
	-D ESP32_C3
	-D ESP_COREDUMP_ENABLE_TO_NONE
	-Os
	-fno-exceptions
	-ffunction-sections
	-fdata-sections
	-Wl,--gc-sections
	-Wl,--relax
	-D CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=1
	-D CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG_RX_BUF_EN=1
	-D CONFIG_ESP_WIFI_ENABLE_WPA3=1
	-D CONFIG_ESPTOOLPY_FLASHFREQ_80M


; Minimal build: only WebSocket client + simple sensors/relays + OTA
build_src_filter = 
	-<*>
	+<main.cpp>
	+<vps_websocket.cpp>
	+<relays_simple.cpp>
	+<sensors_simple.cpp>

lib_deps = 
	adafruit/Adafruit Unified Sensor@^1.1.14
	bblanchon/ArduinoJson@^6.21.5
	arduino-libraries/NTPClient@^3.2.1
	links2004/WebSockets@^2.5.4
	adafruit/DHT sensor library@^1.4.6

upload_protocol = esptool
; Note: ESP32-C3 USB JTAG port auto-detects; usually /dev/ttyACM0 on Linux
; OTA support: Access via http://greenhouse-esp32c3.local/update with password protection

