<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenhouse - Control System</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
    <meta name="theme-color" content="#10b981">
    <meta name="description" content="Greenhouse Control System - Monitor and control your greenhouse environment">
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                    <path d="M12 6v6m0 0l-3-3m3 3l3-3"/>
                </svg>
                <h1 class="logo-text">Greenhouse</h1>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item active" data-view="dashboard">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span class="nav-text">Dashboard</span>
            </li>
            <li class="nav-item" data-view="sensors">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>
                </svg>
                <span class="nav-text">Sensores</span>
            </li>
            <li class="nav-item" data-view="control">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 7h.01M3 13h18M5 17h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                </svg>
                <span class="nav-text">Control</span>
                <span class="nav-badge" id="relayBadge" style="display:none;">!</span>
            </li>
            <li class="nav-item" data-view="system">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.66 5.66l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.66-5.66l4.24-4.24"/>
                </svg>
                <span class="nav-text">Sistema</span>
            </li>
            <li class="nav-item" data-view="logs">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8m8 4H8m8 4H8"/>
                </svg>
                <span class="nav-text">Logs</span>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="connection-status" id="connectionStatus">
                <div class="status-indicator" id="statusIndicator"></div>
                <span class="status-text" id="statusText">Conectando...</span>
            </div>
            <button class="btn-icon" id="authBtn" title="Autenticación API">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
            </button>
            <span id="authStatus" class="auth-status" style="margin-left:auto; font-size:0.85rem; color: var(--text-secondary);">No auth</span>
            <button class="btn-icon" id="logoutBtn" title="Cerrar sesión" style="display:none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <path d="M16 17l5-5-5-5"/>
                    <path d="M21 12H9"/>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Global Alert Bar -->
        <div class="alert-bar" id="alertBar" style="display:none;">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            <span class="alert-message" id="alertMessage"></span>
            <button class="alert-close-btn" id="alertCloseBtn">×</button>
        </div>

        <!-- VIEW: Dashboard Overview -->
                
                <!-- Sensor Status Cards -->
                <div class="sensor-grid">
                    <div class="sensor-card" id="dht-card">
                        <div class="sensor-header">
                            <h3>DHT11 Sensor</h3>
                            <div class="sensor-status" id="dht-status">🔴</div>
                        </div>
                        <div class="sensor-values">
                            <div class="value-item">
                                <span class="label">Temperature:</span>
                                <span class="value" id="temperature">--°C</span>
                            </div>
                            <div class="value-item">
                                <span class="label">Humidity:</span>
                                <span class="value" id="humidity">--%</span>
                            </div>
                        </div>
                    </div>

                    <div class="sensor-card" id="soil-card">
                        <div class="sensor-header">
                            <h3>Soil Moisture</h3>
                            <div class="sensor-status" id="soil-status">🔴</div>
                        </div>
                        <div class="sensor-values">
                            <div class="value-item">
                                <span class="label">Sensor 1:</span>
                                <span class="value" id="soil1">--%</span>
                            </div>
                            <div class="value-item">
                                <span class="label">Sensor 2:</span>
                                <span class="value" id="soil2">--%</span>
                            </div>
                        </div>
                    </div>

                    <div class="sensor-card" id="temp-sensors-card">
                        <div class="sensor-header">
                            <h3>Temperature Sensors</h3>
                            <div class="sensor-status" id="temp-sensors-status">�</div>
                        </div>
                        <div class="sensor-values">
                            <div class="value-item">
                                <span class="label">External 1:</span>
                                <span class="value" id="temp1">--°C</span>
                            </div>
                            <div class="value-item">
                                <span class="label">External 2:</span>
                                <span class="value" id="temp2">--°C</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>Temperature & Humidity Trends</h3>
                        <div class="chart-controls">
                            <label>
                                <input type="checkbox" id="showTemp" checked> Temperature
                            </label>
                            <label>
                                <input type="checkbox" id="showHumidity" checked> Humidity
                            </label>
                        </div>
                        <canvas id="envChart" width="800" height="300"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3>Soil Moisture Levels</h3>
                        <canvas id="soilChart" width="800" height="300"></canvas>
                    </div>
                </div>

                <!-- Statistics Panel -->
                <div class="stats-panel">
                    <h3>� Environmental Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Temp Range:</span>
                            <span class="stat-value" id="tempRange">-- to --°C</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Temp Average:</span>
                            <span class="stat-value" id="tempAvg">--°C</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Humidity Range:</span>
                            <span class="stat-value" id="humidityRange">-- to --%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Humidity Average:</span>
                            <span class="stat-value" id="humidityAvg">--%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Relay Control Section -->
            <section class="dashboard-section" id="relay-section">
                <div class="section-header">
                    <h2>🔌 Relay Control System</h2>
                    <div class="relay-controls">
                        <button class="btn btn-warning" id="authBtn">🔐 Authenticate</button>
                        <button class="btn btn-secondary" style="display:none;" id="refreshRelays">🔄 Refresh</button>
                    </div>
                </div>

                <!-- Authentication required notice -->
                <div class="auth-notice" id="authNotice">
                    <div class="notice-content">
                        <h3>🔒 Authentication Required</h3>
                        <p>Relay control requires API authentication. Click "Authenticate" to enter your token.</p>
                    </div>
                </div>

                <!-- Relay Grid (Hidden until authenticated) -->
                <div class="relay-grid" id="relayGrid" style="display: none;">
                    <!-- Relay cards will be populated dynamically -->
                </div>

                <!-- Relay Usage Statistics -->
                <div class="relay-stats" id="relayStats" style="display: none;">
                    <h3>📊 Usage Statistics</h3>
                    <div class="usage-grid">
                        <!-- Usage stats will be populated dynamically -->
                    </div>
                </div>
            </section>

            <!-- System Information Section -->
            <section class="dashboard-section">
                <div class="section-header">
                    <h2>💻 System Information</h2>
                    <button class="btn btn-secondary" id="refreshSystemBtn">🔄 Refresh</button>
                </div>

                <div class="system-grid">
                    <div class="system-card">
                        <h3>Memory Usage</h3>
                        <div class="memory-info">
                            <div class="memory-bar">
                                <div class="memory-used" id="memoryBar"></div>
                            </div>
                            <div class="memory-details">
                                <span>Free: <strong id="freeHeap">--</strong></span>
                                <span>Fragmentation: <strong id="fragmentation">--%</strong></span>
                            </div>
                        </div>
                    </div>

                    <div class="system-card">
                        <h3>Network Status</h3>
                        <div class="network-info">
                            <div class="network-item">
                                <span>Status:</span>
                                <span id="networkStatus">--</span>
                            </div>
                            <div class="network-item">
                                <span>Signal:</span>
                                <span id="signalStrength">-- dBm</span>
                            </div>
                            <div class="network-item">
                                <span>Reconnects:</span>
                                <span id="reconnectCount">--</span>
                            </div>
                        </div>
                    </div>

                    <div class="system-card">
                        <h3>Performance</h3>
                        <div class="performance-info">
                            <div class="perf-item">
                                <span>Loop Average:</span>
                                <span id="loopAvg">-- μs</span>
                            </div>
                            <div class="perf-item">
                                <span>System State:</span>
                                <span id="systemState">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-info">
                <span>Greenhouse Control System v3.0</span>
                <span>Last data: <span id="lastDataTime">Never</span></span>
            </div>
        </footer>
    </div>

    <!-- Authentication Modal -->
    <div class="modal-overlay" id="authModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔐 API Authentication</h3>
                <button class="modal-close" id="modalCloseBtn">×</button>
            </div>
            <div class="modal-body">
                <p>Enter your API token to access relay controls and advanced features:</p>
                <input type="password" id="authToken" placeholder="Enter API token" class="auth-input">
                <div class="auth-buttons">
                    <button class="btn btn-primary" id="authenticateBtn">Authenticate</button>
                    <button class="btn btn-secondary" id="cancelAuthBtn">Cancel</button>
                </div>
                <div class="auth-help">
                    <small>Token is stored locally and encrypted. Check your system configuration for the API token.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

        <script src="/script.js"></script>
</body>
</html>