# Greenhouse Project Nginx Reverse Proxy Configuration
#
# How to use this file on your VPS:
# 1. Copy this file to your Nginx configuration directory.
#    Example: sudo cp vps_nginx_proxy_config.conf /etc/nginx/snippets/greenhouse.conf
#
# 2. Include this snippet inside your main server block for reimon.dev.
#    Example (in /etc/nginx/sites-available/reimon.dev):
#
#    server {
#        listen 443 ssl;
#        server_name reimon.dev;
#
#        # ... your other SSL and server settings ...
#
#        include /etc/nginx/snippets/greenhouse.conf;
#
#        # ... your other location blocks ...
#    }
#
# 3. Test and reload Nginx:
#    sudo nginx -t
#    sudo systemctl reload nginx

location /greenhouse/ {
    # This rewrite rule removes the '/greenhouse/' prefix from the URL
    # before passing it to the Docker container. This is crucial because
    # the internal Nginx expects requests to start from the root (/).
    # Example: https://reimon.dev/greenhouse/index.html -> /index.html
    rewrite ^/greenhouse/(.*)$ /$1 break;

    # Proxy the request to the 'app' service defined in your
    # docker-compose.prod.yml. Docker's internal DNS will resolve
    # 'app' to the container's IP address.
    # We are targeting port 80, which is the port the internal Nginx listens on.
    proxy_pass http://app:80;

    # Standard proxy headers to pass along client information
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket support
    # These headers are required to correctly proxy WebSocket connections,
    # which are used for the real-time features of the dashboard.
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
